<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme=""
  
    class="html theme--light"
  
><head>
  <title>
    Seán O&#39;Doherty
        |
        Homework 4
      

    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.113.0"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="Seán O&#39;Doherty" />
  <meta
    name="description"
    content="E628 Portfolio Website"
  />
  
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.1147aa5bacb4bce677a0e264073829caedb82fd18ea07a5f1d80521f539d1c45.css"
      integrity="sha256-EUeqW6y0vOZ3oOJkBzgpyu24L9GOoHpfHYBSH1OdHEU="
      crossorigin="anonymous"
      type="text/css"
    />
  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css"
    integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css"
    integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css"
    integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css"
    integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css"
    integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />

  <link rel="canonical" href="https://seanodoherty-portfolio-website.netlify.app/post/sod_homework4_new/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js"
    integrity="sha256-&#43;RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js"
      integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc="
      crossorigin="anonymous"
    ></script>
  

  


  
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://seanodoherty-portfolio-website.netlify.app/images/site-feature-image.png"/>

<meta name="twitter:title" content="Homework 4"/>
<meta name="twitter:description" content="The Bechdel Test https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/
The Bechdel test is a way to assess how women are depicted in Hollywood movies."/>



  
  <meta property="og:title" content="Homework 4" />
<meta property="og:description" content="The Bechdel Test https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/
The Bechdel test is a way to assess how women are depicted in Hollywood movies." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://seanodoherty-portfolio-website.netlify.app/post/sod_homework4_new/" /><meta property="og:image" content="https://seanodoherty-portfolio-website.netlify.app/images/site-feature-image.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-06-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-06-07T00:00:00+00:00" /><meta property="og:site_name" content="Seán O&#39;Doherty - Portfolio Website" />



  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "post",
        "name": "Homework 4",
        "headline": "Homework 4",
        "alternativeHeadline": "",
        "description": "
      
        The Bechdel Test https:\/\/fivethirtyeight.com\/features\/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women\/\nThe Bechdel test is a way to assess how women are depicted in Hollywood movies.


      


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/seanodoherty-portfolio-website.netlify.app\/post\/sod_homework4_new\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Seán O\u0027Doherty"
        },
        "creator" : {
            "@type": "Person",
            "name": "Seán O\u0027Doherty"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Seán O\u0027Doherty"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Seán O\u0027Doherty"
        },
        "copyrightYear" : "2023",
        "dateCreated": "2023-06-07T00:00:00.00Z",
        "datePublished": "2023-06-07T00:00:00.00Z",
        "dateModified": "2023-06-07T00:00:00.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Seán O'Doherty",
            "url": "https://seanodoherty-portfolio-website.netlify.app/",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/seanodoherty-portfolio-website.netlify.app\/favicons\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
        
        "https://seanodoherty-portfolio-website.netlify.app/images/site-feature-image.png"


      
      ]

    ,
        "url" : "https:\/\/seanodoherty-portfolio-website.netlify.app\/post\/sod_homework4_new\/",
        "wordCount" : "4401",
        "genre" : [ ],
        "keywords" : [ ]
    }
  </script>


</head>
<body class="body">
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"
        
      ><div
  class="sidebar
    animated fadeInDown
  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="/images/Sean%20O%27Doherty.jpg"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/">Seán O&#39;Doherty - Portfolio Website</a>
        </div>
      
      <div class="sidebar__introduction-description">
        <p>E628 Portfolio Website</p>
      </div>
    </div>
    <ul class="sidebar__list">
      
        <li class="sidebar__list-item">
          <a
            href="https://www.linkedin.com/in/sean-odoherty/"
            target="_blank"
            rel="noopener me"
            aria-label="Linkedin"
            title="Linkedin"
          >
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
        <li class="sidebar__list-item">
          <a
            href="https://github.com/seanodoherty"
            target="_blank"
            rel="noopener me"
            aria-label="GitHub"
            title="GitHub"
          >
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
    </ul>
  </div><footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Seán O&#39;Doherty
        2023
      
    </li>
    
      <li class="footer__item">
        <a
          class="link"
          href="/imprint/"
          
          title=""
        >
          imprint
        </a>
      </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main
        
          class="wrapper__main"
        
      >
        <header class="header"><div
  class="
    animated fadeInDown
  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/post/"
              
              title=""
              >Posts</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/portfolio/"
              
              title=""
              >Portfolio</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/about/"
              
              title=""
              >About</a
            >
          </li>
        

      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
        <li class="nav__list-item">
          <div class="themeswitch">
            <a title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </div>
        </li>
      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown
    "
  >
    
    <div class="post__content">
      <h1>Homework 4</h1>
      
        <ul class="post__meta">
          <li class="post__meta-item">
            <em class="fas fa-calendar-day post__meta-icon"></em>
            <span class="post__meta-text"
              >
                
                  2023-06-07
                

              
            </span>
          </li>
          <li class="post__meta-item">
            <em class="fas fa-stopwatch post__meta-icon"></em>
            <span class="post__meta-text">21-minute read</span>
          </li>
        </ul>
      <h1 id="the-bechdel-test">The Bechdel Test</h1>
<p><a href="https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/">https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/</a></p>
<p>The <a href="https://bechdeltest.com">Bechdel test</a> is a way to assess how women are depicted in Hollywood movies. In order for a movie to pass the test:</p>
<ol>
<li>It has to have at least two [named] women in it</li>
<li>Who talk to each other</li>
<li>About something besides a man</li>
</ol>
<p>There is a nice article and analysis you can find here <a href="https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/">https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/</a> We have a sample of 1394 movies and we want to fit a model to predict whether a film passes the test or not.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel</span> <span class="o">&lt;-</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">here</span><span class="o">::</span><span class="nf">here</span><span class="p">(</span><span class="s">&#34;data&#34;</span><span class="p">,</span> <span class="s">&#34;bechdel.csv&#34;</span><span class="p">))</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">test</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">test</span><span class="p">))</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Rows: 1394 Columns: 10
</span></span><span class="line"><span class="cl">## ── Column specification ────────────────────────────────────────────────────────
</span></span><span class="line"><span class="cl">## Delimiter: &#34;,&#34;
</span></span><span class="line"><span class="cl">## chr (4): title, test, rated, genre
</span></span><span class="line"><span class="cl">## dbl (6): year, budget_2013, domgross_2013, intgross_2013, metascore, imdb_ra...
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## ℹ Use `spec()` to retrieve the full column specification for this data.
</span></span><span class="line"><span class="cl">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">glimpse</span><span class="p">(</span><span class="n">bechdel</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Rows: 1,394
</span></span><span class="line"><span class="cl">## Columns: 10
</span></span><span class="line"><span class="cl">## $ year          &lt;dbl&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 20…
</span></span><span class="line"><span class="cl">## $ title         &lt;chr&gt; &#34;12 Years a Slave&#34;, &#34;2 Guns&#34;, &#34;42&#34;, &#34;47 Ronin&#34;, &#34;A Good …
</span></span><span class="line"><span class="cl">## $ test          &lt;fct&gt; Fail, Fail, Fail, Fail, Fail, Pass, Pass, Fail, Pass, Pa…
</span></span><span class="line"><span class="cl">## $ budget_2013   &lt;dbl&gt; 2.00, 6.10, 4.00, 22.50, 9.20, 1.20, 1.30, 13.00, 4.00, …
</span></span><span class="line"><span class="cl">## $ domgross_2013 &lt;dbl&gt; 5.3107035, 7.5612460, 9.5020213, 3.8362475, 6.7349198, 1…
</span></span><span class="line"><span class="cl">## $ intgross_2013 &lt;dbl&gt; 15.8607035, 13.2493015, 9.5020213, 14.5803842, 30.424919…
</span></span><span class="line"><span class="cl">## $ rated         &lt;chr&gt; &#34;R&#34;, &#34;R&#34;, &#34;PG-13&#34;, &#34;PG-13&#34;, &#34;R&#34;, &#34;R&#34;, &#34;PG-13&#34;, &#34;PG-13&#34;, …
</span></span><span class="line"><span class="cl">## $ metascore     &lt;dbl&gt; 97, 55, 62, 29, 28, 55, 48, 33, 90, 58, 52, 78, 83, 53, …
</span></span><span class="line"><span class="cl">## $ imdb_rating   &lt;dbl&gt; 8.3, 6.8, 7.6, 6.6, 5.4, 7.8, 5.7, 5.0, 7.5, 7.4, 6.2, 7…
</span></span><span class="line"><span class="cl">## $ genre         &lt;chr&gt; &#34;Biography&#34;, &#34;Action&#34;, &#34;Biography&#34;, &#34;Action&#34;, &#34;Action&#34;, …
</span></span></code></pre></div><p>How many films fail/pass the test, both as a number and as a %?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># group by pass / fail</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># get counts</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">film_count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># calculate line count over total count</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">film_pct</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">film_count</span><span class="p">)</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">film_count</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 2 × 3
</span></span><span class="line"><span class="cl">##   test  film_count film_pct
</span></span><span class="line"><span class="cl">##   &lt;fct&gt;      &lt;int&gt;    &lt;dbl&gt;
</span></span><span class="line"><span class="cl">## 1 Fail         772    0.554
</span></span><span class="line"><span class="cl">## 2 Pass         622    0.446
</span></span></code></pre></div><h2 id="movie-scores">Movie scores</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="o">=</span> <span class="n">metascore</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">y</span> <span class="o">=</span> <span class="n">imdb_rating</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">colour</span> <span class="o">=</span> <span class="n">test</span>
</span></span><span class="line"><span class="cl"><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="m">.3</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;tomato&#34;</span><span class="p">,</span> <span class="s">&#34;olivedrab&#34;</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Metacritic score&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;IMDB rating&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;Bechdel test&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl"> <span class="nf">theme_light</span><span class="p">()</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-3-1.png" width="672" />
<h1 id="split-the-data">Split the data</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># **Split the data**</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data_split</span> <span class="o">&lt;-</span> <span class="nf">initial_split</span><span class="p">(</span><span class="n">bechdel</span><span class="p">,</span> <span class="c1"># updated data</span>
</span></span><span class="line"><span class="cl">                           <span class="n">prop</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                           <span class="n">strata</span> <span class="o">=</span> <span class="n">test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bechdel_train</span> <span class="o">&lt;-</span> <span class="nf">training</span><span class="p">(</span><span class="n">data_split</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">bechdel_test</span> <span class="o">&lt;-</span> <span class="nf">testing</span><span class="p">(</span><span class="n">data_split</span><span class="p">)</span>
</span></span></code></pre></div><p>Check the counts and % (proportions) of the <code>test</code> variable in each set.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">count_and_prop</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">df</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># group by pass / fail</span>
</span></span><span class="line"><span class="cl">    <span class="nf">group_by</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># get counts</span>
</span></span><span class="line"><span class="cl">    <span class="nf">summarise</span><span class="p">(</span><span class="n">film_count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># calculate line count over total count</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mutate</span><span class="p">(</span><span class="n">film_pct</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">film_count</span><span class="p">)</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">film_count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="nf">count_and_prop</span><span class="p">(</span><span class="n">bechdel</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 2 × 3
</span></span><span class="line"><span class="cl">##   test  film_count film_pct
</span></span><span class="line"><span class="cl">##   &lt;fct&gt;      &lt;int&gt;    &lt;dbl&gt;
</span></span><span class="line"><span class="cl">## 1 Fail         772    0.554
</span></span><span class="line"><span class="cl">## 2 Pass         622    0.446
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">count_and_prop</span><span class="p">(</span><span class="n">bechdel_train</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 2 × 3
</span></span><span class="line"><span class="cl">##   test  film_count film_pct
</span></span><span class="line"><span class="cl">##   &lt;fct&gt;      &lt;int&gt;    &lt;dbl&gt;
</span></span><span class="line"><span class="cl">## 1 Fail         617    0.554
</span></span><span class="line"><span class="cl">## 2 Pass         497    0.446
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">count_and_prop</span><span class="p">(</span><span class="n">bechdel_test</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 2 × 3
</span></span><span class="line"><span class="cl">##   test  film_count film_pct
</span></span><span class="line"><span class="cl">##   &lt;fct&gt;      &lt;int&gt;    &lt;dbl&gt;
</span></span><span class="line"><span class="cl">## 1 Fail         155    0.554
</span></span><span class="line"><span class="cl">## 2 Pass         125    0.446
</span></span></code></pre></div><h2 id="feature-exploration">Feature exploration</h2>
<h2 id="any-outliers">Any outliers?</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">budget_2013</span><span class="p">,</span> <span class="n">domgross_2013</span><span class="p">,</span> <span class="n">intgross_2013</span><span class="p">,</span> <span class="n">imdb_rating</span><span class="p">,</span> <span class="n">metascore</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">pivot_longer</span><span class="p">(</span><span class="n">cols</span> <span class="o">=</span> <span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;feature&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#34;value&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">test</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_flip</span><span class="p">()</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_boxplot</span><span class="p">()</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">feature</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="s">&#34;free&#34;</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_bw</span><span class="p">()</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-6-1.png" width="672" />
<h2 id="scatterplot---correlation-matrix">Scatterplot - Correlation Matrix</h2>
<p>Write a paragraph discussing the output of the following</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">budget_2013</span><span class="p">,</span> <span class="n">domgross_2013</span><span class="p">,</span> <span class="n">intgross_2013</span><span class="p">,</span> <span class="n">imdb_rating</span><span class="p">,</span> <span class="n">metascore</span><span class="p">)</span><span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggpairs</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">test</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_bw</span><span class="p">()</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-7-1.png" width="672" />
<p><em>The distributions of the other variables in relation to the test result suggest that there is not a huge difference between movies which pass the test and those which fail. The small differences imply that those which fail as a whole have slightly higher budget, domestic and international gross, and imdb rating and much the same metascore than those which pass. While some of the variables exhibit correlations with each other, those correlations are observed in both the passing and failing movies.</em></p>
<h2 id="categorical-variables">Categorical variables</h2>
<p>Write a paragraph discussing the output of the following</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">prop</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## `summarise()` has grouped output by &#39;genre&#39;. You can override using the
</span></span><span class="line"><span class="cl">## `.groups` argument.
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 24 × 4
</span></span><span class="line"><span class="cl">## # Groups:   genre [14]
</span></span><span class="line"><span class="cl">##    genre     test      n  prop
</span></span><span class="line"><span class="cl">##    &lt;chr&gt;     &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
</span></span><span class="line"><span class="cl">##  1 Action    Fail    260 0.707
</span></span><span class="line"><span class="cl">##  2 Action    Pass    108 0.293
</span></span><span class="line"><span class="cl">##  3 Adventure Fail     52 0.559
</span></span><span class="line"><span class="cl">##  4 Adventure Pass     41 0.441
</span></span><span class="line"><span class="cl">##  5 Animation Fail     63 0.677
</span></span><span class="line"><span class="cl">##  6 Animation Pass     30 0.323
</span></span><span class="line"><span class="cl">##  7 Biography Fail     36 0.554
</span></span><span class="line"><span class="cl">##  8 Biography Pass     29 0.446
</span></span><span class="line"><span class="cl">##  9 Comedy    Fail    138 0.427
</span></span><span class="line"><span class="cl">## 10 Comedy    Pass    185 0.573
</span></span><span class="line"><span class="cl">## # ℹ 14 more rows
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">rated</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">prop</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## `summarise()` has grouped output by &#39;rated&#39;. You can override using the
</span></span><span class="line"><span class="cl">## `.groups` argument.
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 10 × 4
</span></span><span class="line"><span class="cl">## # Groups:   rated [5]
</span></span><span class="line"><span class="cl">##    rated test      n  prop
</span></span><span class="line"><span class="cl">##    &lt;chr&gt; &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
</span></span><span class="line"><span class="cl">##  1 G     Fail     16 0.615
</span></span><span class="line"><span class="cl">##  2 G     Pass     10 0.385
</span></span><span class="line"><span class="cl">##  3 NC-17 Fail      5 0.833
</span></span><span class="line"><span class="cl">##  4 NC-17 Pass      1 0.167
</span></span><span class="line"><span class="cl">##  5 PG    Fail    115 0.561
</span></span><span class="line"><span class="cl">##  6 PG    Pass     90 0.439
</span></span><span class="line"><span class="cl">##  7 PG-13 Fail    283 0.529
</span></span><span class="line"><span class="cl">##  8 PG-13 Pass    252 0.471
</span></span><span class="line"><span class="cl">##  9 R     Fail    353 0.568
</span></span><span class="line"><span class="cl">## 10 R     Pass    269 0.432
</span></span></code></pre></div><p><em>The distripbution of passes and fails does vary quite a bit across genres. Musical and Thiller all pass. Documentary and Sci-Fi all fail. Across the genres which have the most films, Horror and Comedy have the highest proportion of passes. Action has the most films and a low proportion of passes.</em></p>
<p><em>The rating does not appear to affect the proportion of passes much with the exception of NC-17 which passes much less frequently than the others.</em></p>
<h1 id="train-first-models-test--metascore--imdb_rating">Train first models. <code>test ~ metascore + imdb_rating</code></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lr_mod</span> <span class="o">&lt;-</span> <span class="nf">logistic_reg</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="n">engine</span> <span class="o">=</span> <span class="s">&#34;glm&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">lr_mod</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Logistic Regression Model Specification (classification)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Computational engine: glm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tree_mod</span> <span class="o">&lt;-</span> <span class="nf">decision_tree</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="n">engine</span> <span class="o">=</span> <span class="s">&#34;C5.0&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_mod</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Decision Tree Model Specification (classification)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Computational engine: C5.0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lr_fit</span> <span class="o">&lt;-</span> <span class="n">lr_mod</span> <span class="o">%&gt;%</span> <span class="c1"># parsnip model</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fit</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">metascore</span> <span class="o">+</span> <span class="n">imdb_rating</span><span class="p">,</span> <span class="c1"># a formula</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel_train</span> <span class="c1"># dataframe</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_fit</span> <span class="o">&lt;-</span> <span class="n">tree_mod</span> <span class="o">%&gt;%</span> <span class="c1"># parsnip model</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fit</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">metascore</span> <span class="o">+</span> <span class="n">imdb_rating</span><span class="p">,</span> <span class="c1"># a formula</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel_train</span> <span class="c1"># dataframe</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h2 id="logistic-regression">Logistic regression</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lr_fit</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="n">broom</span><span class="o">::</span><span class="nf">tidy</span><span class="p">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 3 × 5
</span></span><span class="line"><span class="cl">##   term        estimate std.error statistic  p.value
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
</span></span><span class="line"><span class="cl">## 1 (Intercept)   2.80     0.494        5.68 1.35e- 8
</span></span><span class="line"><span class="cl">## 2 metascore     0.0207   0.00536      3.86 1.13e- 4
</span></span><span class="line"><span class="cl">## 3 imdb_rating  -0.625    0.100       -6.24 4.36e-10
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lr_preds</span> <span class="o">&lt;-</span> <span class="n">lr_fit</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">augment</span><span class="p">(</span><span class="n">new_data</span> <span class="o">=</span> <span class="n">bechdel_train</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">.pred_match</span> <span class="o">=</span> <span class="nf">if_else</span><span class="p">(</span><span class="n">test</span> <span class="o">==</span> <span class="n">.pred_class</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="confusion-matrix">Confusion matrix</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lr_preds</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">conf_mat</span><span class="p">(</span><span class="n">truth</span> <span class="o">=</span> <span class="n">test</span><span class="p">,</span> <span class="n">estimate</span> <span class="o">=</span> <span class="n">.pred_class</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#34;heatmap&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-12-1.png" width="672" />
<h2 id="decision-tree">Decision Tree</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tree_preds</span> <span class="o">&lt;-</span> <span class="n">tree_fit</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">augment</span><span class="p">(</span><span class="n">new_data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">.pred_match</span> <span class="o">=</span> <span class="nf">if_else</span><span class="p">(</span><span class="n">test</span> <span class="o">==</span> <span class="n">.pred_class</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tree_preds</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">conf_mat</span><span class="p">(</span><span class="n">truth</span> <span class="o">=</span> <span class="n">test</span><span class="p">,</span> <span class="n">estimate</span> <span class="o">=</span> <span class="n">.pred_class</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#34;heatmap&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-14-1.png" width="672" />
<h2 id="draw-the-decision-tree">Draw the decision tree</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">draw_tree</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">    <span class="n">rpart</span><span class="o">::</span><span class="nf">rpart</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">test</span> <span class="o">~</span> <span class="n">metascore</span> <span class="o">+</span> <span class="n">imdb_rating</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel_train</span><span class="p">,</span> <span class="c1"># uses data that contains both birth weight and `low`</span>
</span></span><span class="line"><span class="cl">        <span class="n">control</span> <span class="o">=</span> <span class="n">rpart</span><span class="o">::</span><span class="nf">rpart.control</span><span class="p">(</span><span class="n">maxdepth</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">cp</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">minsplit</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">    <span class="n">partykit</span><span class="o">::</span><span class="nf">as.party</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">draw_tree</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-15-1.png" width="672" />
<h1 id="cross-validation">Cross Validation</h1>
<p>Run the code below. What does it return?</p>
<p><em>It splits the data into 10 &lsquo;folds&rsquo;. The splits column conrtains list objects which store the tibbles of each fold. I have adapted the code to only 5 folds as 10 was crashing my computer.</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bechdel_folds</span> <span class="o">&lt;-</span> <span class="nf">vfold_cv</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">bechdel_train</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                          <span class="n">v</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                          <span class="n">strata</span> <span class="o">=</span> <span class="n">test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bechdel_folds</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## #  5-fold cross-validation using stratification 
</span></span><span class="line"><span class="cl">## # A tibble: 5 × 2
</span></span><span class="line"><span class="cl">##   splits            id   
</span></span><span class="line"><span class="cl">##   &lt;list&gt;            &lt;chr&gt;
</span></span><span class="line"><span class="cl">## 1 &lt;split [890/224]&gt; Fold1
</span></span><span class="line"><span class="cl">## 2 &lt;split [890/224]&gt; Fold2
</span></span><span class="line"><span class="cl">## 3 &lt;split [892/222]&gt; Fold3
</span></span><span class="line"><span class="cl">## 4 &lt;split [892/222]&gt; Fold4
</span></span><span class="line"><span class="cl">## 5 &lt;split [892/222]&gt; Fold5
</span></span></code></pre></div><h2 id="fit_resamples"><code>fit_resamples()</code></h2>
<p>Trains and tests a resampled model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">lr_fit</span> <span class="o">&lt;-</span> <span class="n">lr_mod</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">test</span> <span class="o">~</span> <span class="n">metascore</span> <span class="o">+</span> <span class="n">imdb_rating</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_fit</span> <span class="o">&lt;-</span> <span class="n">tree_mod</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">test</span> <span class="o">~</span> <span class="n">metascore</span> <span class="o">+</span> <span class="n">imdb_rating</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><h2 id="collect_metrics"><code>collect_metrics()</code></h2>
<p>Unnest the metrics column from a tidymodels <code>fit_resamples()</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">collect_metrics</span><span class="p">(</span><span class="n">lr_fit</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 2 × 6
</span></span><span class="line"><span class="cl">##   .metric  .estimator  mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy binary     0.576     5  0.0169 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 roc_auc  binary     0.604     5  0.0136 Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">collect_metrics</span><span class="p">(</span><span class="n">tree_fit</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 2 × 6
</span></span><span class="line"><span class="cl">##   .metric  .estimator  mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy binary     0.551     5 0.00765 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 roc_auc  binary     0.527     5 0.0119  Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">tree_preds</span> <span class="o">&lt;-</span> <span class="n">tree_mod</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">test</span> <span class="o">~</span> <span class="n">metascore</span> <span class="o">+</span> <span class="n">imdb_rating</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">control</span> <span class="o">=</span> <span class="nf">control_resamples</span><span class="p">(</span><span class="n">save_pred</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="c1">#&lt;&lt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># What does the data for ROC look like?</span>
</span></span><span class="line"><span class="cl"><span class="n">tree_preds</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_predictions</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">roc_curve</span><span class="p">(</span><span class="n">truth</span> <span class="o">=</span> <span class="n">test</span><span class="p">,</span> <span class="n">.pred_Fail</span><span class="p">)</span>  
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 15 × 3
</span></span><span class="line"><span class="cl">##    .threshold specificity sensitivity
</span></span><span class="line"><span class="cl">##         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
</span></span><span class="line"><span class="cl">##  1   -Inf          0           1     
</span></span><span class="line"><span class="cl">##  2      0.277      0           1     
</span></span><span class="line"><span class="cl">##  3      0.316      0.0201      0.976 
</span></span><span class="line"><span class="cl">##  4      0.441      0.0302      0.968 
</span></span><span class="line"><span class="cl">##  5      0.450      0.0885      0.916 
</span></span><span class="line"><span class="cl">##  6      0.514      0.145       0.878 
</span></span><span class="line"><span class="cl">##  7      0.549      0.262       0.771 
</span></span><span class="line"><span class="cl">##  8      0.554      0.451       0.598 
</span></span><span class="line"><span class="cl">##  9      0.558      0.650       0.399 
</span></span><span class="line"><span class="cl">## 10      0.569      0.783       0.256 
</span></span><span class="line"><span class="cl">## 11      0.673      0.901       0.136 
</span></span><span class="line"><span class="cl">## 12      0.778      0.966       0.0665
</span></span><span class="line"><span class="cl">## 13      0.781      0.988       0.0389
</span></span><span class="line"><span class="cl">## 14      0.782      0.990       0.0194
</span></span><span class="line"><span class="cl">## 15    Inf          1           0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Draw the ROC</span>
</span></span><span class="line"><span class="cl"><span class="n">tree_preds</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_predictions</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">roc_curve</span><span class="p">(</span><span class="n">truth</span> <span class="o">=</span> <span class="n">test</span><span class="p">,</span> <span class="n">.pred_Fail</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">()</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-19-1.png" width="672" />
<h1 id="build-a-better-training-set-with-recipes">Build a better training set with <code>recipes</code></h1>
<h2 id="preprocessing-options">Preprocessing options</h2>
<ul>
<li>Encode categorical predictors</li>
<li>Center and scale variables</li>
<li>Handle class imbalance</li>
<li>Impute missing data</li>
<li>Perform dimensionality reduction</li>
<li>&hellip; &hellip;</li>
</ul>
<h2 id="to-build-a-recipe">To build a recipe</h2>
<ol>
<li>Start the <code>recipe()</code></li>
<li>Define the variables involved</li>
<li>Describe <strong>prep</strong>rocessing [step-by-step]</li>
</ol>
<h2 id="collapse-some-categorical-levels">Collapse Some Categorical Levels</h2>
<p>Do we have any <code>genre</code> with few observations? Assign genres that have less than 3% to a new category &lsquo;Other&rsquo;</p>
<img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-20-1.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl">  <span class="nf">recipe</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">.,</span>
</span></span><span class="line"><span class="cl">         <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel_train</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1"># Genres with less than 3% will be in a catewgory &#39;Other&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">step_other</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">.03</span><span class="p">)</span> 
</span></span></code></pre></div><h2 id="before-recipe">Before recipe</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">bechdel_train</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">count</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 14 × 2
</span></span><span class="line"><span class="cl">##    genre           n
</span></span><span class="line"><span class="cl">##    &lt;chr&gt;       &lt;int&gt;
</span></span><span class="line"><span class="cl">##  1 Action        293
</span></span><span class="line"><span class="cl">##  2 Comedy        254
</span></span><span class="line"><span class="cl">##  3 Drama         213
</span></span><span class="line"><span class="cl">##  4 Adventure      75
</span></span><span class="line"><span class="cl">##  5 Animation      72
</span></span><span class="line"><span class="cl">##  6 Crime          68
</span></span><span class="line"><span class="cl">##  7 Horror         68
</span></span><span class="line"><span class="cl">##  8 Biography      50
</span></span><span class="line"><span class="cl">##  9 Mystery         7
</span></span><span class="line"><span class="cl">## 10 Fantasy         5
</span></span><span class="line"><span class="cl">## 11 Sci-Fi          3
</span></span><span class="line"><span class="cl">## 12 Thriller        3
</span></span><span class="line"><span class="cl">## 13 Documentary     2
</span></span><span class="line"><span class="cl">## 14 Musical         1
</span></span></code></pre></div><h2 id="after-recipe">After recipe</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">prep</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">bake</span><span class="p">(</span><span class="n">new_data</span> <span class="o">=</span> <span class="n">bechdel_train</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">count</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 9 × 2
</span></span><span class="line"><span class="cl">##   genre         n
</span></span><span class="line"><span class="cl">##   &lt;fct&gt;     &lt;int&gt;
</span></span><span class="line"><span class="cl">## 1 Action      293
</span></span><span class="line"><span class="cl">## 2 Comedy      254
</span></span><span class="line"><span class="cl">## 3 Drama       213
</span></span><span class="line"><span class="cl">## 4 Adventure    75
</span></span><span class="line"><span class="cl">## 5 Animation    72
</span></span><span class="line"><span class="cl">## 6 Crime        68
</span></span><span class="line"><span class="cl">## 7 Horror       68
</span></span><span class="line"><span class="cl">## 8 Biography    50
</span></span><span class="line"><span class="cl">## 9 other        21
</span></span></code></pre></div><h2 id="step_dummy"><code>step_dummy()</code></h2>
<p>Converts nominal data into numeric dummy variables</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">&lt;-</span> <span class="nf">recipe</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_other</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">.03</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_dummy</span><span class="p">(</span><span class="nf">all_nominal_predictors</span><span class="p">())</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">movie_rec</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ── Recipe ──────────────────────────────────────────────────────────────────────
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ── Inputs
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Number of variables by role
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## outcome:   1
</span></span><span class="line"><span class="cl">## predictor: 9
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ── Operations
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Collapsing factor levels for: genre
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Dummy variables from: all_nominal_predictors()
</span></span></code></pre></div><h2 id="lets-think-about-the-modelling">Let&rsquo;s think about the modelling</h2>
<p>What if there were no films with <code>rated</code> NC-17 in the training data?</p>
<ul>
<li>Will the model have a coefficient for <code>rated</code> NC-17?</li>
<li>What will happen if the test data includes a film with <code>rated</code> NC-17?</li>
</ul>
<h2 id="step_novel"><code>step_novel()</code></h2>
<p>Adds a catch-all level to a factor for any new values not encountered in model training, which lets R intelligently predict new levels in the test set.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">&lt;-</span> <span class="nf">recipe</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_other</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">.03</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_novel</span><span class="p">(</span><span class="n">all_nominal_predictors</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># Use *before* `step_dummy()` so new level is dummified</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_dummy</span><span class="p">(</span><span class="nf">all_nominal_predictors</span><span class="p">())</span> 
</span></span></code></pre></div><h2 id="step_zv"><code>step_zv()</code></h2>
<p>Intelligently handles zero variance variables (variables that contain only a single value)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">&lt;-</span> <span class="nf">recipe</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_other</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">.03</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_novel</span><span class="p">(</span><span class="nf">all_nominal</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> <span class="o">%&gt;%</span> <span class="c1"># Use *before* `step_dummy()` so new level is dummified</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_dummy</span><span class="p">(</span><span class="nf">all_nominal</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_zv</span><span class="p">(</span><span class="nf">all_numeric</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> 
</span></span></code></pre></div><h2 id="step_normalize"><code>step_normalize()</code></h2>
<p>Centers then scales numeric variable (mean = 0, sd = 1)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">&lt;-</span> <span class="nf">recipe</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_other</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">.03</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_novel</span><span class="p">(</span><span class="nf">all_nominal</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> <span class="o">%&gt;%</span> <span class="c1"># Use *before* `step_dummy()` so new level is dummified</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_dummy</span><span class="p">(</span><span class="nf">all_nominal</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_zv</span><span class="p">(</span><span class="nf">all_numeric</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span>  <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_normalize</span><span class="p">(</span><span class="nf">all_numeric</span><span class="p">())</span> 
</span></span></code></pre></div><h2 id="step_corr"><code>step_corr()</code></h2>
<p>Removes highly correlated variables</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">movie_rec</span> <span class="o">&lt;-</span> <span class="nf">recipe</span><span class="p">(</span><span class="n">test</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">bechdel</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_other</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">.03</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_novel</span><span class="p">(</span><span class="nf">all_nominal</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> <span class="o">%&gt;%</span> <span class="c1"># Use *before* `step_dummy()` so new level is dummified</span>
</span></span><span class="line"><span class="cl">  <span class="nf">step_dummy</span><span class="p">(</span><span class="nf">all_nominal</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_zv</span><span class="p">(</span><span class="nf">all_numeric</span><span class="p">(),</span> <span class="o">-</span><span class="nf">all_outcomes</span><span class="p">())</span>  <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_normalize</span><span class="p">(</span><span class="nf">all_numeric</span><span class="p">())</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">step_corr</span><span class="p">(</span><span class="nf">all_predictors</span><span class="p">(),</span> <span class="n">threshold</span> <span class="o">=</span> <span class="m">0.75</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#34;spearman&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">movie_rec</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ── Recipe ──────────────────────────────────────────────────────────────────────
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ── Inputs
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Number of variables by role
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## outcome:   1
</span></span><span class="line"><span class="cl">## predictor: 9
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ── Operations
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Collapsing factor levels for: genre
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Novel factor level assignment for: all_nominal(), -all_outcomes()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Dummy variables from: all_nominal(), -all_outcomes()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Zero variance filter on: all_numeric(), -all_outcomes()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## • Centering and scaling for: all_numeric()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zed" data-lang="zed"><span class="line"><span class="cl"><span class="err">##</span><span class="w"> </span><span class="err">•</span><span class="w"> </span><span class="n">Correlation</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">on</span><span class="o">:</span><span class="w"> </span><span class="n">all_predictors</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><h1 id="define-different-models-to-fit">Define different models to fit</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Model Building</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. Pick a `model type`</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. set the `engine`</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Set the `mode`: regression or classification</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Logistic regression</span>
</span></span><span class="line"><span class="cl"><span class="n">log_spec</span> <span class="o">&lt;-</span>  <span class="nf">logistic_reg</span><span class="p">()</span> <span class="o">%&gt;%</span>  <span class="c1"># model type</span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="n">engine</span> <span class="o">=</span> <span class="s">&#34;glm&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>  <span class="c1"># model engine</span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span> <span class="c1"># model mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show your model specification</span>
</span></span><span class="line"><span class="cl"><span class="n">log_spec</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Logistic Regression Model Specification (classification)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Computational engine: glm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Decision Tree</span>
</span></span><span class="line"><span class="cl"><span class="n">tree_spec</span> <span class="o">&lt;-</span> <span class="nf">decision_tree</span><span class="p">()</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="n">engine</span> <span class="o">=</span> <span class="s">&#34;C5.0&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_spec</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Decision Tree Model Specification (classification)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Computational engine: C5.0
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Random Forest</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ranger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rf_spec</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">rand_forest</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="s">&#34;ranger&#34;</span><span class="p">,</span> <span class="n">importance</span> <span class="o">=</span> <span class="s">&#34;impurity&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Boosted tree (XGBoost)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">xgboost</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Attaching package: &#39;xgboost&#39;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## The following object is masked from &#39;package:dplyr&#39;:
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">##     slice
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">xgb_spec</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">boost_tree</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="s">&#34;xgboost&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># K-nearest neighbour (k-NN)</span>
</span></span><span class="line"><span class="cl"><span class="n">knn_spec</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">nearest_neighbor</span><span class="p">(</span><span class="n">neighbors</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># we can adjust the number of neighbors </span>
</span></span><span class="line"><span class="cl">  <span class="nf">set_engine</span><span class="p">(</span><span class="s">&#34;kknn&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">set_mode</span><span class="p">(</span><span class="s">&#34;classification&#34;</span><span class="p">)</span> 
</span></span></code></pre></div><h1 id="bundle-recipe-and-model-with-workflows">Bundle recipe and model with <code>workflows</code></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">log_wflow</span> <span class="o">&lt;-</span> <span class="c1"># new workflow object</span>
</span></span><span class="line"><span class="cl"> <span class="nf">workflow</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="c1"># use workflow function</span>
</span></span><span class="line"><span class="cl"> <span class="nf">add_recipe</span><span class="p">(</span><span class="n">movie_rec</span><span class="p">)</span> <span class="o">%&gt;%</span>   <span class="c1"># use the new recipe</span>
</span></span><span class="line"><span class="cl"> <span class="nf">add_model</span><span class="p">(</span><span class="n">log_spec</span><span class="p">)</span>   <span class="c1"># add your model spec</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># show object</span>
</span></span><span class="line"><span class="cl"><span class="n">log_wflow</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## ══ Workflow ════════════════════════════════════════════════════════════════════
</span></span><span class="line"><span class="cl">## Preprocessor: Recipe
</span></span><span class="line"><span class="cl">## Model: logistic_reg()
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## ── Preprocessor ────────────────────────────────────────────────────────────────
</span></span><span class="line"><span class="cl">## 6 Recipe Steps
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## • step_other()
</span></span><span class="line"><span class="cl">## • step_novel()
</span></span><span class="line"><span class="cl">## • step_dummy()
</span></span><span class="line"><span class="cl">## • step_zv()
</span></span><span class="line"><span class="cl">## • step_normalize()
</span></span><span class="line"><span class="cl">## • step_corr()
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## ── Model ───────────────────────────────────────────────────────────────────────
</span></span><span class="line"><span class="cl">## Logistic Regression Model Specification (classification)
</span></span><span class="line"><span class="cl">## 
</span></span><span class="line"><span class="cl">## Computational engine: glm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## A few more workflows</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_wflow</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl"> <span class="nf">workflow</span><span class="p">()</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl"> <span class="nf">add_recipe</span><span class="p">(</span><span class="n">movie_rec</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl"> <span class="nf">add_model</span><span class="p">(</span><span class="n">tree_spec</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rf_wflow</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl"> <span class="nf">workflow</span><span class="p">()</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl"> <span class="nf">add_recipe</span><span class="p">(</span><span class="n">movie_rec</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl"> <span class="nf">add_model</span><span class="p">(</span><span class="n">rf_spec</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xgb_wflow</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl"> <span class="nf">workflow</span><span class="p">()</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl"> <span class="nf">add_recipe</span><span class="p">(</span><span class="n">movie_rec</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl"> <span class="nf">add_model</span><span class="p">(</span><span class="n">xgb_spec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">knn_wflow</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl"> <span class="nf">workflow</span><span class="p">()</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl"> <span class="nf">add_recipe</span><span class="p">(</span><span class="n">movie_rec</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl"> <span class="nf">add_model</span><span class="p">(</span><span class="n">knn_spec</span><span class="p">)</span>
</span></span></code></pre></div><p>HEADS UP</p>
<ol>
<li>
<p>How many models have you specified?</p>
<p><em>There are 5 different models specified in different workflows.</em></p>
</li>
<li>
<p>What&rsquo;s the difference between a model specification and a workflow?</p>
<p><em>The model is the the mathematical component and the workflow is combining that with the recipe which is the data handling elements.</em></p>
</li>
<li>
<p>Do you need to add a formula (e.g., <code>test ~ .</code>) if you have a recipe?</p>
<p><em>This is contained in the recipe.</em></p>
</li>
</ol>
<h1 id="model-comparison">Model Comparison</h1>
<p>You now have all your models. Adapt the code from slides <code>code-from-slides-CA-housing.R</code>, line 400 onwards to assess which model gives you the best classification.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Logistic regression results{.smaller}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log_res</span> <span class="o">&lt;-</span> <span class="n">log_wflow</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="nf">metric_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f_meas</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">kap</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">control</span> <span class="o">=</span> <span class="nf">control_resamples</span><span class="p">(</span><span class="n">save_pred</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## → A | warning: glm.fit: algorithm did not converge
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## There were issues with some computations   A: x1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## → B | warning: prediction from rank-deficient fit; attr(*, &#34;non-estim&#34;) has doubtful cases
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## There were issues with some computations   A: x1
</span></span><span class="line"><span class="cl">There were issues with some computations   A: x1   B: x1
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x2   B: x1
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x2   B: x2
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x3   B: x2
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x3   B: x3
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x4   B: x3
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x4   B: x4
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x5   B: x4
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x5   B: x5
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x5   B: x5
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Show average performance over all folds (note that we use log_res):</span>
</span></span><span class="line"><span class="cl"><span class="n">log_res</span> <span class="o">%&gt;%</span>  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 6
</span></span><span class="line"><span class="cl">##   .metric   .estimator    mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary      0.481      5  0.0191 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary      0.461      5  0.0254 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary     -0.0185     5  0.0379 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary      0.544      5  0.0247 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary      0.404      5  0.0325 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 roc_auc   binary      0.475      5  0.0243 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 sens      binary      0.404      5  0.0325 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 spec      binary      0.578      5  0.0404 Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Show performance for every single fold:</span>
</span></span><span class="line"><span class="cl"><span class="n">log_res</span> <span class="o">%&gt;%</span>  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 40 × 5
</span></span><span class="line"><span class="cl">##    id    .metric   .estimator .estimate .config             
</span></span><span class="line"><span class="cl">##    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">##  1 Fold1 recall    binary        0.5    Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  2 Fold1 precision binary        0.590  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  3 Fold1 f_meas    binary        0.541  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  4 Fold1 accuracy  binary        0.531  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  5 Fold1 kap       binary        0.0687 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  6 Fold1 sens      binary        0.5    Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  7 Fold1 spec      binary        0.57   Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  8 Fold1 roc_auc   binary        0.533  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">##  9 Fold2 recall    binary        0.347  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 10 Fold2 precision binary        0.478  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## # ℹ 30 more rows
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## `collect_predictions()` and get confusion matrix{.smaller}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log_pred</span> <span class="o">&lt;-</span> <span class="n">log_res</span> <span class="o">%&gt;%</span> <span class="nf">collect_predictions</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log_pred</span> <span class="o">%&gt;%</span>  <span class="nf">conf_mat</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">.pred_class</span><span class="p">)</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">##           Truth
</span></span><span class="line"><span class="cl">## Prediction Fail Pass
</span></span><span class="line"><span class="cl">##       Fail  249  210
</span></span><span class="line"><span class="cl">##       Pass  368  287
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">log_pred</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">conf_mat</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">.pred_class</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#34;heatmap&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-32-1.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## ROC Curve</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log_pred</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># id contains our folds</span>
</span></span><span class="line"><span class="cl">  <span class="nf">roc_curve</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">.pred_Fail</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">()</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-32-2.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Decision Tree results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_res</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl">  <span class="n">tree_wflow</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="nf">metric_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f_meas</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">accuracy</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">roc_auc</span><span class="p">,</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">control</span> <span class="o">=</span> <span class="nf">control_resamples</span><span class="p">(</span><span class="n">save_pred</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_res</span> <span class="o">%&gt;%</span>  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 6
</span></span><span class="line"><span class="cl">##   .metric   .estimator  mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary     0.604     5 0.0146  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary     0.645     5 0.00941 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary     0.197     5 0.0319  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary     0.642     5 0.0176  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary     0.650     5 0.0100  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 roc_auc   binary     0.586     5 0.0208  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 sens      binary     0.650     5 0.0100  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 spec      binary     0.547     5 0.0341  Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Random Forest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rf_res</span> <span class="o">&lt;-</span>
</span></span><span class="line"><span class="cl">  <span class="n">rf_wflow</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="nf">metric_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f_meas</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">accuracy</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">roc_auc</span><span class="p">,</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">control</span> <span class="o">=</span> <span class="nf">control_resamples</span><span class="p">(</span><span class="n">save_pred</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rf_res</span> <span class="o">%&gt;%</span>  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 6
</span></span><span class="line"><span class="cl">##   .metric   .estimator  mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary     0.635     5  0.0239 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary     0.699     5  0.0191 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary     0.245     5  0.0505 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary     0.645     5  0.0205 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary     0.763     5  0.0226 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 roc_auc   binary     0.663     5  0.0204 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 sens      binary     0.763     5  0.0226 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 spec      binary     0.477     5  0.0389 Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Boosted tree - XGBoost</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xgb_res</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">xgb_wflow</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="nf">metric_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f_meas</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">accuracy</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">roc_auc</span><span class="p">,</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">control</span> <span class="o">=</span> <span class="nf">control_resamples</span><span class="p">(</span><span class="n">save_pred</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xgb_res</span> <span class="o">%&gt;%</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 6
</span></span><span class="line"><span class="cl">##   .metric   .estimator  mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary     0.609     5 0.00944 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary     0.660     5 0.0102  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary     0.202     5 0.0201  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary     0.638     5 0.00971 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary     0.686     5 0.0204  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 roc_auc   binary     0.630     5 0.0151  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 sens      binary     0.686     5 0.0204  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 spec      binary     0.515     5 0.0276  Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## K-nearest neighbour</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">knn_res</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">knn_wflow</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">fit_resamples</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">resamples</span> <span class="o">=</span> <span class="n">bechdel_folds</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="nf">metric_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f_meas</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">accuracy</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">roc_auc</span><span class="p">,</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">control</span> <span class="o">=</span> <span class="nf">control_resamples</span><span class="p">(</span><span class="n">save_pred</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="c1">## → A | warning: While computing binary `precision()`, no predicted events were detected (i.e. `true_positive + false_positive = 0`). 
</span></span></span><span class="line"><span class="cl"><span class="c1">##                Precision is undefined in this case, and `NA` will be returned.
</span></span></span><span class="line"><span class="cl"><span class="c1">##                Note that 123 true event(s) actually occured for the problematic event level, &#39;Fail&#39;.
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## There were issues with some computations   A: x1
</span></span><span class="line"><span class="cl">## There were issues with some computations   A: x1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">knn_res</span> <span class="o">%&gt;%</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 6
</span></span><span class="line"><span class="cl">##   .metric   .estimator     mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary     0.532        5 0.0217  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary     0.712        4 0.00167 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary     0.000864     5 0.00450 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary     0.554        4 0.00131 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary     0.797        5 0.199   Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 roc_auc   binary     0.549        5 0.0289  Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 sens      binary     0.797        5 0.199   Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 spec      binary     0.204        5 0.199   Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Model Comparison</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log_metrics</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">log_res</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarise</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># add the name of the model to every row</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="s">&#34;Logistic Regression&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tree_metrics</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">tree_res</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarise</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="s">&#34;Decision Tree&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rf_metrics</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">rf_res</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarise</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="s">&#34;Random Forest&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xgb_metrics</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">xgb_res</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarise</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="s">&#34;XGBoost&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">knn_metrics</span> <span class="o">&lt;-</span> 
</span></span><span class="line"><span class="cl">  <span class="n">knn_res</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarise</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="s">&#34;Knn&#34;</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># create dataframe with all models</span>
</span></span><span class="line"><span class="cl"><span class="n">model_compare</span> <span class="o">&lt;-</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">log_metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">tree_metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">rf_metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">xgb_metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">knn_metrics</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Pivot wider to create barplot</span>
</span></span><span class="line"><span class="cl">  <span class="n">model_comp</span> <span class="o">&lt;-</span> <span class="n">model_compare</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">.metric</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std_err</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">pivot_wider</span><span class="p">(</span><span class="n">names_from</span> <span class="o">=</span> <span class="n">.metric</span><span class="p">,</span> <span class="n">values_from</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std_err</span><span class="p">))</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># show mean are under the curve (ROC-AUC) for every model</span>
</span></span><span class="line"><span class="cl"><span class="n">model_comp</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">arrange</span><span class="p">(</span><span class="n">mean_roc_auc</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="nf">fct_reorder</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mean_roc_auc</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="c1"># order results</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mean_roc_auc</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">model</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_col</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_flip</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Blues&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">   <span class="nf">geom_text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="nf">round</span><span class="p">(</span><span class="n">mean_roc_auc</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">         <span class="n">y</span> <span class="o">=</span> <span class="n">mean_roc_auc</span> <span class="o">+</span> <span class="m">0.08</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_light</span><span class="p">()</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;none&#34;</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-39-1.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## `last_fit()` on test set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># - `last_fit()`  fits a model to the whole training data and evaluates it on the test set. </span>
</span></span><span class="line"><span class="cl"><span class="c1"># - provide the workflow object of the best model as well as the data split object (not the training data). </span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">last_fit_rf</span> <span class="o">&lt;-</span> <span class="nf">last_fit</span><span class="p">(</span><span class="n">rf_wflow</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">split</span> <span class="o">=</span> <span class="n">data_split</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">metrics</span> <span class="o">=</span> <span class="nf">metric_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                          <span class="n">accuracy</span><span class="p">,</span> <span class="n">f_meas</span><span class="p">,</span> <span class="n">kap</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">recall</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">sens</span><span class="p">,</span> <span class="n">spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">last_fit_rf</span> <span class="o">%&gt;%</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 4
</span></span><span class="line"><span class="cl">##   .metric   .estimator .estimate .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary         0.579 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary         0.663 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary         0.120 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary         0.595 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary         0.748 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 sens      binary         0.748 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 spec      binary         0.368 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 roc_auc   binary         0.624 Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">#Compare to training</span>
</span></span><span class="line"><span class="cl"><span class="n">rf_res</span> <span class="o">%&gt;%</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">summarize</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## # A tibble: 8 × 6
</span></span><span class="line"><span class="cl">##   .metric   .estimator  mean     n std_err .config             
</span></span><span class="line"><span class="cl">##   &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
</span></span><span class="line"><span class="cl">## 1 accuracy  binary     0.635     5  0.0239 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 2 f_meas    binary     0.699     5  0.0191 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 3 kap       binary     0.245     5  0.0505 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 4 precision binary     0.645     5  0.0205 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 5 recall    binary     0.763     5  0.0226 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 6 roc_auc   binary     0.663     5  0.0204 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 7 sens      binary     0.763     5  0.0226 Preprocessor1_Model1
</span></span><span class="line"><span class="cl">## 8 spec      binary     0.477     5  0.0389 Preprocessor1_Model1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Variable importance using `{vip}` package</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">last_fit_rf</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">pluck</span><span class="p">(</span><span class="s">&#34;.workflow&#34;</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span>   
</span></span><span class="line"><span class="cl">  <span class="nf">pull_workflow_fit</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">vip</span><span class="p">(</span><span class="n">num_features</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_light</span><span class="p">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
</span></span><span class="line"><span class="cl">## ℹ Please use `extract_fit_parsnip()` instead.
</span></span><span class="line"><span class="cl">## This warning is displayed once every 8 hours.
</span></span><span class="line"><span class="cl">## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
</span></span><span class="line"><span class="cl">## generated.
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-41-1.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Final Confusion Matrix</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">last_fit_rf</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">collect_predictions</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">conf_mat</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">.pred_class</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#34;heatmap&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-42-1.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1">## Final ROC curve</span>
</span></span><span class="line"><span class="cl"><span class="n">last_fit_rf</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">collect_predictions</span><span class="p">()</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">roc_curve</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">.pred_Fail</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">autoplot</span><span class="p">()</span>
</span></span></code></pre></div><img src="/english/post/sod_homework4_new_files/figure-html/unnamed-chunk-43-1.png" width="672" />
<h1 id="deliverables">Deliverables</h1>
<p>There is a lot of explanatory text, comments, etc. You do not need these, so delete them and produce a stand-alone document that you could share with someone. Knit the edited and completed R Markdown (Rmd) file as a Word or HTML document (use the &ldquo;Knit&rdquo; button at the top of the script editor window) and upload it to Canvas. You must be commiting and pushing your changes to your own Github repo as you go along.</p>
<h1 id="details">Details</h1>
<ul>
<li>Who did you collaborate with: TYPE NAMES HERE</li>
<li>Approximately how much time did you spend on this problem set: ANSWER HERE</li>
<li>What, if anything, gave you the most trouble: ANSWER HERE</li>
</ul>
<p><strong>Please seek out help when you need it,</strong> and remember the <a href="https://dsb2023.netlify.app/syllabus/#the-15-minute-rule">15-minute rule</a>{target=&quot;_blank&quot;}. You know enough R (and have enough examples of code from class and your readings) to be able to do this. If you get stuck, ask for help from others, post a question on Slack&ndash; and remember that I am here to help too!</p>
<blockquote>
<p>As a true test to yourself, do you understand the code you submitted and are you able to explain it to someone else?</p>
</blockquote>
<h1 id="rubric">Rubric</h1>
<p>13/13: Problem set is 100% completed. Every question was attempted and answered, and most answers are correct. Code is well-documented (both self-documented and with additional comments as necessary). Used tidyverse, instead of base R. Graphs and tables are properly labelled. Analysis is clear and easy to follow, either because graphs are labeled clearly or you&rsquo;ve written additional text to describe how you interpret the output. Multiple Github commits. Work is exceptional. I will not assign these often.</p>
<p>8/13: Problem set is 60&ndash;80% complete and most answers are correct. This is the expected level of performance. Solid effort. Hits all the elements. No clear mistakes. Easy to follow (both the code and the output). A few Github commits.</p>
<p>5/13: Problem set is less than 60% complete and/or most answers are incorrect. This indicates that you need to improve next time. I will hopefully not assign these often. Displays minimal effort. Doesn&rsquo;t complete all components. Code is poorly written and not documented. Uses the same type of plot for each graph, or doesn&rsquo;t use plots appropriate for the variables being analyzed. No Github commits.</p>
</div>
    <div class="post__footer">
      

      
    </div>

    
  </div>

      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Seán O&#39;Doherty
        2023
      
    </li>
    
      <li class="footer__item">
        <a
          class="link"
          href="/imprint/"
          
          title=""
        >
          imprint
        </a>
      </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></body>
</html>
